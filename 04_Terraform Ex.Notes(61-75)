TERRAFORM NOTES for the following:  

61. Data source - FORMAT
-------------------------


Using the data source block we can fetch a particular instance. Look for the details of this in the AWS Resource -> Documentation panel. 
Data source uses tags, which are very important to maintain a large environment with 1000s of instances. 

Ask @need to research on the usecases, apart from update, environment seggregation and network related changes, can there be any use of this on Application deployment ? 

data "aws_instance" "foo" {
instance_id = "i-instance-id" 
}

filter{
name = "image-id"
values = ["ami-xxxxxx"]
}

filter{
name = "tag:name"
values = ["instance-name-tag] 
} 

62. Usecase = Problem Definition :Fetch the latest OS image using Data Source
------------------------------------------------------------------------------
* Avoid hard coded static values in Terraform code. 
Use terraform to query the latest OS image and using that to create an instance. 

63. Usecase: Solution
-----------------------
could not find the os_release | ami_id | latest_patch in the Azure Resource block, not able to convert this for Azure. 

64. Debugging in TERRAFORM 
---------------------------

40% of time will go into Debugging. Documentation / config issue. 
-- Always maintain a detailed log. 
Enable TF_LOG in Terraform 

Store the file in TF_LOG_PATH 

Logs in the decreasing number of verbosity : 
TRACE
DEBUG
INFO
WARN
ERROR 

65 - TERRAFORM Debug setup 
---------------------------
> set TF_LOG = INFRO | TRACE  ( Windows) 
> export TF_LOG = TRACE ( Linux) 

Where is it storing these logs ? 
export TF_LOG_PATH=/temp/terraform-%date%.log

When we use "SET" its session dependent, it would disappear in the next session. 

66 - TERRAFORM Debugging Model : Types of errors cause
------------------------------------------------------
1. Language Errors: Syntax error in cfg
2. State Error: locked statefile, out of sync etc
3. CORE Error : Related with the bugs in Terraform -- keep an eye on the github repos on the open issues. label = bug  
4. PROVIDER Error: Issue with the provider plugin, could even report the issue. terraform-provider-azure | terraform-provider-aws in GIT 

67. Report bugs in the Terraform github repository - create an issue -> bug report -> details 

68. Use terraform fmt command for the formatting the right indentation. 

69. Load order and Semantics
------------------------------
provider.tf 
variable.tf 
semantics.tf 
iam_users.tf 

Its better to divide the production code with different blocks. And when we run terraform plan, it all comes together

70. Terraform Dynamic Block
-----------------------------
This allows to dynamically construct repeatable nested blocks which is supported inside resouce, data, provider and provisioner blocks. 

dynamic "ingress" {
for_each = var.ingress_ports /* ITERATIONS 
content{
  from_port = 
  to_port = 
  protocol = 
  cidr_blocks = ["0.0.0.0/0"]  
      }
}

variable sg_ports{
type = list(numbers)
default = [1000, 2000, 8080, 8081, 9001]   /*VALUE PASSED THROUGH THE EACH ITERATIONS
}

71. Validating Terraform configurations files: terraform.validate.tf 
-----------------------------------------------------------------------
terraform validate 
  -- can checked with unsupported args
 -- undeclaired variables 

72. TAINT
--------------
Can be used when correcting the manual changes done within the envirnment. terraform uses -replace option. 
terraform apply  -replace="aws_instance_web"

73. Spalat Expression
------------------------
Allows us to get a list of all attributes 


74: Terraform graph
---------------------
shows the visual representation of the resource dependencies in a Terraform configuration. Helps to plan, debug and manage complex relationships between various parts of a complex environment. 

First the code is generated and then we can put the code on graphviz or other websites and the dependency diagrams would be generated. 

Command: terraform graph -type=plan | dot Tpng > graph.png 
                                     | dot Tsvg > graph.svg 


75. Save terraform plan to a file
-----------------------------------
can save the plan as a different file at various stage. 

Usecase: For any planned changes, the details of the old config files would be neccessary evident. Plan -out new.terraform is an important part of CHANGE MANAGEMENT

terraform show -json infra.plan | jq































































































































































